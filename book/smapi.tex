\documentclass[a5paper, 11pt, twoside]{book}  % Based on the ECS Thesis style
% \usepackage{graphicx}
\usepackage{makeidx}
\usepackage{graphicx}
\graphicspath{{../figures/}}  % Location of the graphics files
\usepackage{multirow}
% Making R code work!
\usepackage{listings}
\usepackage{color}
\usepackage{hyperref}
\usepackage{booktabs}

\hypersetup{urlcolor=blue, colorlinks=false, hypertexnames=true}  % Colours hyperlinks in blue, but this can be distracting 
\usepackage{cleveref}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{ %
  language=R,                % the language of the code
   basicstyle=\normalsize\ttfamily,           % the size of the fonts that are used for the code
%   numbers=left,                   % where to put the line-numbers
%   numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
%   stepnumber=2,                   % the step between two line-numbers. If it's 1, each line
                                  % will be numbered
%   numbersep=5pt,                  % how far the line-numbers are from the code
%   backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
%   showspaces=false,               % show spaces adding particular underscores
%   showstringspaces=false,         % underline spaces within strings
%   showtabs=false,                 % show tabs within strings adding particular underscores
   frame=false,                   % adds a frame around the code
   rulecolor=\color{white},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
%   tabsize=2,                      % sets default tabsize to 2 spaces
%   captionpos=b,                   % sets the caption-position to bottom
%   breaklines=true,                % sets automatic line breaking
%   breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
%   title=\lstname,                   % show the filename of files included with \lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},          % keyword style
  commentstyle=\color{dkgreen},       % comment style
  stringstyle=\color{mauve},         % string literal style
  escapeinside={\%*}{*)},            % if you want to add a comment within your code
  morekeywords={*,...}               % if you want to add more keywords to the set
} 

% Include any extra LaTeX packages required
\usepackage[round,]{natbib}  % Use the "Natbib" style for the references
\usepackage{verbatim}  % Needed for the "comment" environment to make LaTeX comments
\usepackage{wallpaper}
\usepackage{cases}
\makeindex
% \renewcommand{\includegraphics}[2][]{\fbox{#2}} %omits images
\begin{document}
 
\title{Spatial microsimulation: a practical introduction}
% \author{Robin Lovelace --- R.Lovelace at. Leeds. ac. uk}
\pagestyle{myheadings}
\author{Lovelace, Robin\\
\texttt{r.lovelace@leeds.ac.uk}}
\maketitle

\tableofcontents

\chapter{Preface}
% This booklet was written to accompany a two day course of the same title.
% As well as providing useful information to the $\approx$30 participants during
% and after the course, it is hoped that the material will be of use to others.

\chapter{Introduction}

Spatial microsimulation is shrouded by an unnecessary mystery, and this is not
helped by the fact that most academic papers on subject and even textbooks
lack reproducible examples. In today's age of fast
Internet connections, open access datasets and free software,
things need not be this way. One could argue that the lack of
reproducibility in spatial microsimulation is damaging to the growth
and credibility of the field.

To those doubting the value of this practical approach, I ask the following
questions: If only a small community of researchers hold the majority of the
code needed to perform spatial microsimulation, how can the technique spread
rapidly to other applications? If every PhD student undertaking spatial
microsimulation must start from scratch, how are the methods going to be
refined and improved in a systematic fashion? Most importantly, if the results
of most spatial microsimulation research is not reproducible --- as is currently
the case --- how can we trust them?

This final point is critical not only to spatial microsimulation but the
disciplines of which it is part. Reproducibility is a prerequisite of
falsifiability --- if the method
underlying a result cannot be replicated by others, how can the finding
possibly be falsified? Moreover, the argument continues, any knowledge or
theory can only claim to enter the realm of `science' if it cannot be falsified.
Because it is impossible to prove any proposition in every and all cases, the
only reliable test we can apply is whether or not it can be \emph{disproved}:
falsified via a contradictory finding. This is how scientific progress is made
\citep{Popper1959}. By writing non-reproducible research, researchers may
inadvertently damage the disciplines in which they work. %. how???

Despite and because of these philosophical antecedents, the course is
unashamedly practical. The aim is simple: to provide an accessible yet
deep foundation in spatial microsimulation. This involves both
\emph{understanding} and \emph{implementation} of the technique.
Following the `learning by doing' ethic, the former can best be
attained through the latter: spatial microsimulation need not be an abstract
process that one simply reads about. It can be practical tool used by anyone
with the know-how. As \citet[xxii]{kabacoff2011r} put it regarding R, ``the best
way to learn is to experiment'' and the same applies to spatial microsimulation.

The examples presented below were developed during a PhD project in the energy
costs of commuting. Although some of the code and most of the descriptive text
has been rewritten since then, many of the ideas and methods are described in
more detail in the resulting thesis.% \citep{Lovelace2014-thesis}.

\section{Why R?} \label{setsim} % Move this to just before R implementation?

Software decisions have a major impact on the model's flexibility, efficiency,
reproducibility and
ease of coding. \citet[p.~153]{Holm1987} observed that ``little attention is
paid to the choice of programming language used.''
This appears to be as true now as it was then: software is rarely discussed in
spatial microsimulation papers. 
In my own spatial microsimulation research, a conscious decision was made early
on to use R, with impacts on model features, analysis
and even design. It is thus worth understanding the tool a little before we
begin to use it. The theory is discussed in \cref{s:theory}

% \subsection{Why R?}
The world is awash with computer programming languages and many of these
are general purpose and `Turing complete', meaning they could, with sufficient
effort, perform spatial microsimulation. So why would one chose R?
The most important criteria of evaluation include flexibility,
speed of processing and, most importantly, ease and speed of writing code.
R excels in each of these areas, especially the final one: it
is possible to say a lot in R in few lines of code. Further
are provided by \citet{Matloff-R}:

\begin{itemize}
\item ``a public-domain implementation of the widely-regarded S statistical
language; R/S is the de facto standard among professional statisticians
\item comparable, and often superior, in power to commercial products in most
senses
\item available for Windows, Macs, Linux
\item in addition to enabling statistical operations, it's a general programming
language, so that you can
automate your analyses and create new functions
\item object-oriented and functional programming structure
\item your data sets are saved between sessions, so you don't have to reload
each time
\item open-software nature means itâ€™s easy to get help from the user
community''
\end{itemize}
% Add in disadvantages here.

\section{Learning the R language}

Having learned a little about \emph{why} R is a good tool for the job,
it is time to think about \emph{how} R should be used. The most
useful advice I received on the subject is to think of R not as a
series of isolated commands, but as an interconnected \emph{language},
in the fullest sense of the word. R is not only a system by which
instructions can be sent to a computer to process data; R provides a way
of expressing oneself and explaining ideas to other human beings.
Critical to its role as a language is R's unique \emph{syntax}, which allows it
to express relatively complex expressions efficently, with a small number of
keystrokes.

The concise and unusual nature of R code
is not an accident. It was planned to be this way from the
outset by its instigators, Robert Gentleman and Ross Ihaka, who thought
carefully about syntax from the outset:
``the syntax of a language is important
because it determines
the way that users of the language express themselves'' \citep[p.~300]{Ihaka2014}.

\section{Typographic conventions}

\section{An overview of the book}


\chapter{What is spatial microsimulation?}

\section{What spatial microsimulation is not}

\section{A method for generating spatial microdata}

\section{An approach to modelling ecological processes}

\section{A tool for combining insights from multiple scales}

\chapter{Applications}


\section{Updating cross-tabulated census data}

\section{Economic forecasting}

\section{Small area estimation}

\section{Transport modelling}

\section{Dynamic spatial microsimulation}

\section{An input into agent based models}

\chapter{Spatial microsimulation in theory}\label{s:theory}


\section{Iterative Proportional Fitting}

\section{Combinatorial optimisation}

\section{Multilevell modelling}

\chapter{Spatial microsimulation with R}


\section{Loading and cleaning input data}

\section{Comparing individual and aggregate data}

\section{Reweighting using IPF}

\section{Combinatorial optimisation}

\section{Integerisation}

\chapter{Customising code: a worked example with CakeMap}


\section{Preparing the input data}

\section{Performing IPF on CakeMap data}

\section{Integerisation}

\section{Validation}

\section{Visualisations}

\section{Analysis and interpretation}


\chapter{Additional tools and techniques}


\section{The Flexible Modelling Framework (FMF)}

\section{Allocation of home-work locations}

\section{A spatial interaction model with individual agents}

\section{Spatial microdata: an input into agent based models}


\chapter{Conclusions and a peak into the future}

% \section{Acknowledgements}
\chapter{Bibliography}
\label{Bibliography}

\bibliographystyle{plainnat}  
\bibliography{/nfs/foe-fs-01_users/georl/Documents/Microsimulation}  % The
% /nfs/foe-fs-01_users/georl/Documents/Microsimulation,
% /home/robin/Documents/Microsimulation.bib
\addtocontents{toc}{\vspace{2em}}  % Add a gap in the Contents, for aesthetics

%% -----------------------------------------------------------

\printindex
\label{index}
\phantomsection
\addcontentsline{toc}{chapter}{Index}
\end{document}  % The End
